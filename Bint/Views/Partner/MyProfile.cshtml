@inject UserManager<ApplicationUser> UserManager
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor;
@model UserProfileDoc
@{

    Layout = "~/Views/Shared/_PartnerLayout.cshtml";
    var myp = UserManager.GetUserAsync(User).Result;
}
<div class="wrapper">
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0 text-dark">Profile</h1>
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="/partner/dashboard"><i class="fas fa-home mr-2"></i>Home</a></li>
                            <li class="breadcrumb-item active">My Profile</li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-9">
                        <div class="card card-outline card-info">
                            <!-- /.card-header -->
                            <div class="card-body row">
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">User Id</label>


                                    <div class="col-sm-9">
                                        <input type="hidden" id="id" value="@myp.Id">

                                        @myp.UserId
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12 float-right">


                                    <button type="button" class="btn bg-indigo-300 text-white  " data-toggle="modal" data-target="#modal-kycdocs">
                                        KYC Docs
                                    </button>
                                    <button type="button" class="btn bg-indigo-300 text-white  " data-toggle="modal" data-target="#modal-profilepic">
                                        Change Picture
                                    </button>
                                    <a href="/partner/changepassword" class="btn bg-indigo-300 text-white ">
                                        Change Password
                                    </a>
                                    <button type="button" class="btn bg-indigo-300 text-white  " data-toggle="modal" data-target="#modal-tether">
                                        Tether
                                    </button>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Email</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtemail" placeholder="Email" value="@myp.Email" readonly>
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Mobile</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtmobile" placeholder="Mobile" value="@myp.Mobile">
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">First name</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtFirstname" placeholder="First name" value="@myp.Firstname">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Last name</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtlastname" placeholder="Last name" value="@myp.Lastname">
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">Address</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtaddress" placeholder="Address" value="@myp.Address">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">Bank name</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtbankname" placeholder="Bank name" value="@myp.Bankname">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">Bank Account</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtbankaccount" placeholder="Bank name" value="@myp.Bankaccount">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">IFSC Code</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtIFSC" placeholder="IFSC Code" value="@myp.Ifsc_code">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    &nbsp; <label for="inputEmail3" class="col-form-label">Account holder name</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtaccountholder" placeholder="Account holder name" value="@myp.Account_holder_name">
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">PAN</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtpan" placeholder="PAN" value="@myp.Pan">
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label">UPI Id</label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="txtupi" placeholder="UPI Id" value="@myp.Upi_id">
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Created on</label>
                                    <div class="col-sm-9">
                                        @myp.Created_on
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Tether</label>
                                    <div class="col-sm-9">
                                        <center><img src="@myp.QRCode" class="img-fluid w-50" /></center>
                                        @myp.TetherAddress
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputPassword3" class="col-sm-3 col-form-label">Created by</label>
                                    <div class="col-sm-9">
                                        @myp.Created_by
                                    </div>
                                </div>

                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                    <label for="inputEmail3" class="col-sm-3 col-form-label"></label>
                                    <div class="col-sm-9">
                                        <button type="button" id="btnSaveProfile" class="btn bg-indigo-300 text-white">Save</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                        @await Html.PartialAsync("_FileUpload", new UserProfileDoc { UserDocs = Model.UserDocs })
                    </div>
                    @await Html.PartialAsync("_PartnerProfile")

                </div><!--/. container-fluid -->
            </div>
        </section>
        <!-- /.content -->
    </div>
</div>

<div class="modal fade" id="modal-profilepic">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="partner" asp-action="profilepic" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <h4 class="modal-title">Profile Pic</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">File</label>
                        <input type="file" id="file1" name="formFile" accept="image/jpg,image/png,image/jpeg" />
                    </div>
                </div>
                <div class="alert alert-default-primary ml-2 mr-2">
                    <ol>
                        <li>Only .jpeg, .jpg, .png files are allowed to upload</li>
                        <li>Maximum size of file is 1MB</li>
                    </ol>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="submit" class="btn btn-success" id="btnProfilePic">Change Pic</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- /.content-wrapper -->
<div class="modal fade" id="modal-kycdocs">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="partner" asp-action="uploaddocs" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <h4 class="modal-title">KYC Docs</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">File name</label>
                        <input type="text" id="filename" name="filename" />
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">File</label>
                        <input type="file" id="file2" name="formFile" />
                    </div>
                </div>
                <div class="alert alert-default-primary ml-2 mr-2">
                    <ol>
                        <li>Only .txt, .doc, .docx, .pdf, .rar, .zip, .jpg, .jpeg, .png files are allowed to upload</li>
                        <li>Maximum size of file is 2MB</li>
                    </ol>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="submit" class="btn btn-success" id="btnFileUpload">Upload</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<div class="modal fade" id="modal-tether">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="partner" asp-action="TetherUpdate" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <h4 class="modal-title">USD Tether Address</h4>

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-3 col-form-label">Tether Address</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="txtTether" name="txtTether" placeholder="Tether Address">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-3 col-form-label">File</label>
                        <input type="file" id="tetherfile" name="formFile" />
                    </div>
                </div>
                <div class="alert alert-default-primary ml-2 mr-2">
                    <ol>
                        <li>Only .jpeg, .jpg, .png files are allowed to upload</li>
                        <li>Maximum size of file is 1MB</li>
                    </ol>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="submit" class="btn btn-success" id="btnTether">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<script type="text/javascript">
    $(document).ready(function () {

        $("#btnFileUpload").click(function (event) {
            if ($('#filename').val() == '') {
                toastr.error('Filename required'); return false; event.preventDefault();
            }
            if ($('#file2').val() == '') {
                toastr.error('No file selected for upload'); return false; event.preventDefault();
            }
            var formFile = new FormData();
            var file = $('#file2')[0];

            var s = file.files[0].type;
            if (s == "image/jpeg" || s == "image/jpg" || s == "image/png" || s == "application/pdf" || s == "application/x-zip-compressed" || s == "text/plain" || s == "application/vnd.openxmlformats-officedocument.wordprocessingml.document") {

            }
            else {
                toastr.error('Upload valid file'); return false; event.preventDefault();
            }


            if (file.files[0].size > 2048000) { toastr.error('File size exceeds 2Mb'); return false; event.preventDefault(); }

        });


        $("#btnProfilePic").click(function (event) {
            if ($('#file1').val() == '') {
                toastr.error('No file selected for upload'); return false; event.preventDefault();
            }
            var formFile = new FormData();
            var file = $('#file1')[0];

            var s = file.files[0].type;
            if (s == "image/jpeg" || s == "image/jpg" || s == "image/png") {
            }
            else {
                toastr.error('Upload valid image file'); return false; event.preventDefault();
            }


            if (file.files[0].size > 1024000) { toastr.error('Image size exceeds 1Mb'); return false; event.preventDefault(); }

        });

        $('[data-toggle="tooltip"]').tooltip();

        $("#btnSaveProfile").click(function () {

            var id = $("#id").val();
            var firstname = $("#txtFirstname").val();
            var lastname = $("#txtlastname").val();
            var mobile = $("#txtmobile").val();
            var address = $("#txtaddress").val();
            var bankname = $("#txtbankname").val();
            var ifsc = $("#txtIFSC").val();
            var accountholder = $("#txtaccountholder").val();
            var pan = $("#txtpan").val();
            var upi = $("#txtupi").val();
            var bankaccount = $("#txtbankaccount").val();
            var status = true;

            if (upi == "") { toastr.error("Upi required"); status = false; }
            if (pan == "") { toastr.error("Pan number required"); status = false; }
            if (accountholder == "") { toastr.error("Account holder name required"); status = false; }
            if (ifsc == "") { toastr.error("Ifsc required"); status = false; }
            if (bankaccount == "") { toastr.error("Bank account required"); status = false; }
            if (bankname == "") { toastr.error("Bankname required"); status = false; }
            if (address == "") { toastr.error("Address required"); status = false; }
            if (isNaN(mobile)) { toastr.error("Mobile number not valid"); status = false; }
            if (mobile == "") { toastr.error("Mobile number required"); status = false; }
            if (lastname == "") { toastr.error("Lastname required"); status = false; }
            if (firstname == "") { toastr.error("Firstname required"); status = false; }


            if (status) {
                $.ajax({
                    type: "GET",
                    url: "/account/saveprofile",
                    async: false,
                    dataType: "text json",
                    contentType: "application/json;charset=utf-8",
                    data: {
                        "id": id, "firstname": firstname, "lastname": lastname, "mobile": mobile, "address": address, "bankname": bankname, "ifsc": ifsc, "accountholder": accountholder, "pan": pan, "upi": upi, "bankaccount": bankaccount
                    },

                    success: function (data) {

                        if (data == "success") {
                            toastr.success(data); window.location.reload(true);
                        }
                        else {
                            toastr.error(data);
                        }
                    },
                    error: function (a, b, c) {

                        toastr.error("Error occurred");
                    }
                });
            }


        });

        $("#btnTether").click(function (event) {
            if ($("#txtTether").val() == "") {
                toastr.error("Tether address is required"); return false; event.preventDefault();
            }
            if ($('#tetherfile').val() == '') {
                toastr.error('No file selected for upload'); return false; event.preventDefault();
            }
            var formFile = new FormData();
            var file = $('#tetherfile')[0];

            var s = file.files[0].type;
            if (!s.indexOf("image") == 0) {
                toastr.error('Upload valid image file'); return false; event.preventDefault();
            }


        });
    });
</script>